from __future__ import absolute_import
import unittest
import numpy as np

from tests.sample_data import SampleData
from pyti import williams_percent_r


class TestWilliamsPercentR(unittest.TestCase):
    def setUp(self):
        """Create data to use for testing."""
        self.data = SampleData().get_sample_close_data()

        self.wpr_expected = [-33.083683607183765, -25.112724493695076,
        -23.821169277798969, -19.724875811998512, -21.352693924340887,
        -19.915934275888464, -17.990064959877692, -15.697363393198287,
        -17.760794803209787, -19.79365685899883, -15.353458158196428,
        -13.641574321742469, -15.590370653419928, -21.276270538784889,
        -20.091708062667145, -31.004967520061172, -33.832632785632384,
        -45.517768437141804, -43.95873137179975, -54.474589224302605,
        -54.573939625525384, -45.747038593809705, -35.384027512418761,
        -38.173481085212103, -42.44554833779133, -43.362628964463127,
        -38.777225831104317, -38.930072602216313, -45.678257546809306,
        -37.890714558654977, -42.613679786014508, -46.297286969812781,
        -63.064577760794784, -48.903324417271683, -42.376767290791015,
        -23.041650745127988, -18.158196408100867, -25.762323270920923,
        -41.757737867787526, -40.924722965227318, -36.163546045089831,
        -23.125716469239578, -19.747802827665286, -12.365303782957632,
        -14.054260603744734, -10.424149789835678, -5.4948414214750123, -0.0,
        -8.9262514329385247, -10.783339701948805, -6.6106228505922626,
        -10.890332441727168, -22.086358425678238, -23.798242262132195,
        -24.195643867023282, -18.318685517768454, -19.999999999999964,
        -16.484524264424948, -26.771111960259812, -24.959877722583084,
        -26.373710355368729, -25.181505540695483, -27.02330913259458,
        -24.21092854413455, -25.296140619029433, -19.625525410775744,
        -19.113488727550621, -25.288498280473842, -15.880779518532648,
        -15.124188001528438, -23.469621704241522, -27.481849445930479,
        -30.836836071837993, -28.865112724493674, -26.373710355368729,
        -34.604508979747777, -35.934275888421837, -28.21551394726783,
        -36.117692013756198, -25.143293847917441, -21.207489491784482,
        -21.184562476117712, -29.705769965609473, -33.886129155521608,
        -35.070691631639264, -33.488727550630529, -30.508215513947228,
        -32.495223538402733, -33.962552541077606, -32.204814673290009,
        -29.919755445166196, -29.644631257164662, -27.581199847153247,
        -25.212074894917848, -23.17157050057321, -26.404279709591094,
        -22.758884218570856, -21.925869316010736, -21.047000382116895,
        -20.825372564004581, -21.597248758119974, -23.316774933129526,
        -22.017577378677917, -29.415361100496757, -28.139090561711917,
        -27.22200993504012, -26.595338173481046, -33.931983186855149,
        -53.419946503630086, -56.377531524646521, -59.679021780664897,
        -59.778372181887676, -58.433320596102419, -62.155139472678655,
        -60.114635078333933, -62.919373328238457, -63.079862437905966,
        -76.507451280091715, -76.377531524646571, -81.207489491784472,
        -78.891860909438279, -82.949942682460787, -90.149025601834182,
        -98.188765762323271, -96.881925869315978, -100.0, -95.903706534199458]

    def test_wpr(self):
        wpr = williams_percent_r.williams_percent_r(self.data)
        np.testing.assert_array_equal(wpr, self.wpr_expected)
